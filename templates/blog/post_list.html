{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load blog_extras %}

{% block title %}
    {% if category %}{{ category.name }} - {% endif %}
    {% if tag %}{{ tag.name }} - {% endif %}
    {% if search_query %}{% trans "Search Results" %} - {% endif %}
    {% trans "Blog" %} - {{ site_settings.site_name|default:"Muntazir Hazim" }}
{% endblock %}

{% block meta_description %}
    {% if category %}
        {% blocktrans with category_name=category.name %}Explore articles in {{ category_name }} category. Latest insights and tutorials on web development, programming, and technology.{% endblocktrans %}
    {% elif tag %}
        {% blocktrans with tag_name=tag.name %}Articles tagged with {{ tag_name }}. Discover content related to this topic.{% endblocktrans %}
    {% elif search_query %}
        {% blocktrans with query=search_query %}Search results for "{{ query }}". Find relevant articles and tutorials.{% endblocktrans %}
    {% else %}
        {% trans "Explore my blog for the latest articles on web development, Django, React, and programming tutorials. Stay updated with industry insights and best practices." %}
    {% endif %}
{% endblock %}

{% block extra_css %}
<style>
    .blog-card {
        transition: all 0.3s ease;
        overflow: hidden;
    }
    
    .blog-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    }
    
    .blog-image {
        transition: all 0.3s ease;
    }
    
    .blog-card:hover .blog-image {
        transform: scale(1.1);
    }
    
    .category-tag {
        transition: all 0.2s ease;
    }
    
    .category-tag:hover {
        transform: scale(1.05);
    }
    
    .search-overlay {
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.9);
    }
    
    .dark .search-overlay {
        background: rgba(17, 24, 39, 0.9);
    }
    
    .floating-search {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1000;
        width: 90%;
        max-width: 500px;
    }
    
    .tag-cloud .tag {
        transition: all 0.2s ease;
    }
    
    .tag-cloud .tag:hover {
        transform: scale(1.1);
    }
    
    .pagination-btn {
        transition: all 0.2s ease;
    }
    
    .pagination-btn:hover {
        transform: translateY(-2px);
    }
    
    .filter-dropdown {
        backdrop-filter: blur(10px);
        background: rgba(255, 255, 255, 0.95);
    }
    
    .dark .filter-dropdown {
        background: rgba(31, 41, 55, 0.95);
    }
</style>
{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="bg-gradient-to-br from-primary-600 to-primary-800 dark:from-primary-700 dark:to-primary-900 py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h1 class="text-4xl md:text-5xl font-bold text-white mb-4" data-aos="fade-up">
            {% if category %}
                {{ category.name }}
            {% elif tag %}
                {% blocktrans with tag_name=tag.name %}Posts tagged "{{ tag_name }}"{% endblocktrans %}
            {% elif search_query %}
                {% trans "Search Results" %}
            {% else %}
                {% trans "Blog" %}
            {% endif %}
        </h1>
        <p class="text-xl text-primary-100 mb-8 max-w-2xl mx-auto" data-aos="fade-up" data-aos-delay="200">
            {% if category %}
                {{ category.description|default:"Explore articles in this category" }}
            {% elif tag %}
                {% if posts.count == 1 %}
                    {% blocktrans with tag_name=tag.name count=posts.count %}{{ count }} article found for "{{ tag_name }}"{% endblocktrans %}
                {% else %}
                    {% blocktrans with tag_name=tag.name count=posts.count %}{{ count }} articles found for "{{ tag_name }}"{% endblocktrans %}
                {% endif %}
            {% elif search_query %}
                {% if posts.count == 1 %}
                    {% blocktrans with query=search_query count=posts.count %}{{ count }} result found for "{{ query }}"{% endblocktrans %}
                {% else %}
                    {% blocktrans with query=search_query count=posts.count %}{{ count }} results found for "{{ query }}"{% endblocktrans %}
                {% endif %}
            {% else %}
                {% trans "Discover insights, tutorials, and thoughts on web development, programming, and technology." %}
            {% endif %}
        </p>
        
        <!-- Search Bar -->
        <div class="max-w-md mx-auto" data-aos="fade-up" data-aos-delay="400">
            <form method="get" action="{% url 'blog:search' %}" class="relative">
                <input type="text" name="q" value="{{ search_query|default:'' }}" 
                       placeholder="{% trans 'Search articles...' %}" 
                       class="w-full px-4 py-3 pr-12 rtl:pl-12 rtl:pr-4 rounded-lg border border-white/20 bg-white/10 text-white placeholder-white/70 focus:outline-none focus:ring-2 focus:ring-white/50 focus:bg-white/20 transition-all duration-200">
                <button type="submit" class="absolute right-3 rtl:left-3 rtl:right-auto top-1/2 transform -translate-y-1/2 text-white/70 hover:text-white transition-colors duration-200">
                    <i class="fas fa-search"></i>
                </button>
            </form>
        </div>
    </div>
</section>

<!-- Filters and Categories -->
<section class="py-8 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-700">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex flex-col lg:flex-row lg:items-center lg:justify-between gap-6">
            <!-- Categories -->
            <div class="flex flex-wrap gap-3">
                <a href="{% url 'blog:post_list' %}" 
                   class="category-tag px-4 py-2 rounded-full text-sm font-medium transition-colors duration-200 {% if not category and not tag and not search_query %}bg-primary-600 text-white{% else %}bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-primary-100 dark:hover:bg-primary-900 hover:text-primary-600 dark:hover:text-primary-400{% endif %}">
                    {% trans "All Posts" %}
                </a>
                {% for cat in categories %}
                    <a href="{% url 'blog:category_posts' cat.slug %}" 
                       class="category-tag px-4 py-2 rounded-full text-sm font-medium transition-colors duration-200 {% if category.slug == cat.slug %}bg-primary-600 text-white{% else %}bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-primary-100 dark:hover:bg-primary-900 hover:text-primary-600 dark:hover:text-primary-400{% endif %}">
                        {{ cat.name }}
                        <span class="ml-1 rtl:mr-1 rtl:ml-0 text-xs opacity-75">({{ cat.posts.published.count }})</span>
                    </a>
                {% endfor %}
            </div>
            
            <!-- Sort Options -->
            <div class="flex items-center gap-4">
                <span class="text-sm text-gray-600 dark:text-gray-400">{% trans "Sort by:" %}</span>
                <select id="sort-select" class="px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500">
                    <option value="-created_at">{% trans "Latest" %}</option>
                    <option value="created_at">{% trans "Oldest" %}</option>
                    <option value="title">{% trans "Title A-Z" %}</option>
                    <option value="-title">{% trans "Title Z-A" %}</option>
                    <option value="-views">{% trans "Most Popular" %}</option>
                </select>
            </div>
        </div>
    </div>
</section>

<!-- Blog Posts Grid -->
<section class="py-16 bg-gray-50 dark:bg-gray-800">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        {% if posts %}
            <div class="blog-grid grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="posts-grid">
                {% for post in posts %}
                    <article class="blog-card bg-white dark:bg-gray-900 rounded-xl shadow-lg overflow-hidden" data-aos="fade-up" data-aos-delay="{% widthratio forloop.counter0|add:1 1 100 %}">
                        <!-- Post Image -->
                        <div class="relative overflow-hidden h-48">
                            {% if post.cover_image %}
                            <img src="{{ post.cover_image.url }}" alt="{{ post.title }}" class="blog-image w-full h-full object-cover">
                            {% else %}
                                <div class="blog-image w-full h-full bg-gradient-to-br from-primary-400 to-primary-600 flex items-center justify-center">
                                    <i class="fas fa-newspaper text-4xl text-white opacity-50"></i>
                                </div>
                            {% endif %}
                            
                            <!-- Category Badge -->
                            <div class="absolute top-4 left-4 rtl:right-4 rtl:left-auto">
                                <a href="{% url 'blog:category_posts' post.category.slug %}" 
                                   class="px-3 py-1 bg-white/90 dark:bg-gray-900/90 text-primary-600 dark:text-primary-400 text-xs font-medium rounded-full hover:bg-white dark:hover:bg-gray-900 transition-colors duration-200">
                                    {{ post.category.name }}
                                </a>
                            </div>
                            
                            <!-- Reading Time -->
                            <div class="absolute top-4 right-4 rtl:left-4 rtl:right-auto">
                                <span class="px-3 py-1 bg-black/50 text-white text-xs font-medium rounded-full">
                                    <i class="fas fa-clock mr-1 rtl:ml-1 rtl:mr-0"></i>
                                    {{ post.reading_time }} {% trans "min read" %}
                                </span>
                            </div>
                        </div>
                        
                        <!-- Post Content -->
                        <div class="p-6">
                            <!-- Post Meta -->
                            <div class="flex items-center text-sm text-gray-500 dark:text-gray-400 mb-3">
                                <time datetime="{{ post.created_at|date:'c' }}">
                                    <i class="fas fa-calendar mr-2 rtl:ml-2 rtl:mr-0"></i>
                                    {{ post.created_at|date:"M d, Y" }}
                                </time>
                                <span class="mx-2">â€¢</span>
                                <span>
                                    <i class="fas fa-eye mr-1 rtl:ml-1 rtl:mr-0"></i>
                                    {{ post.views_count|default:0 }}
                                </span>
                            </div>
                            
                            <!-- Post Title -->
                            <h2 class="text-xl font-bold text-gray-900 dark:text-white mb-3 line-clamp-2 hover:text-primary-600 dark:hover:text-primary-400 transition-colors duration-200">
                                <a href="{{ post.get_absolute_url }}">
                                    {{ post.title }}
                                </a>
                            </h2>
                            
                            <!-- Post Excerpt -->
                            <p class="text-gray-600 dark:text-gray-300 mb-4 line-clamp-3">
                                {{ post.excerpt|default:post.content|truncatewords:20|striptags }}
                            </p>
                            
                            <!-- Tags -->
                            {% if post.tags.all %}
                                <div class="flex flex-wrap gap-2 mb-4">
                                    {% for tag in post.tags.all|slice:":3" %}
                                        <a href="{% url 'blog:tag_posts' tag.slug %}" 
                                           class="px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 text-xs rounded hover:bg-primary-100 dark:hover:bg-primary-900 hover:text-primary-600 dark:hover:text-primary-400 transition-colors duration-200">
                                            #{{ tag.name }}
                                        </a>
                                    {% endfor %}
                                    {% if post.tags.count > 3 %}
                                        <span class="px-2 py-1 bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-500 text-xs rounded">
                                            +{{ post.tags.count|add:"-3" }}
                                        </span>
                                    {% endif %}
                                </div>
                            {% endif %}
                            
                            <!-- Read More Button -->
                            <div class="flex items-center justify-between">
                                <a href="{{ post.get_absolute_url }}" 
                                   class="inline-flex items-center text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 font-medium transition-colors duration-200">
                                    {% trans "Read More" %}
                                    <i class="fas fa-arrow-right ml-2 rtl:mr-2 rtl:ml-0 transform group-hover:translate-x-1 rtl:group-hover:-translate-x-1 transition-transform duration-200"></i>
                                </a>
                                
                                <!-- Share Button -->
                                <button onclick="sharePost('{{ post.title }}', '{{ post.get_absolute_url|build_absolute_uri:request }}')" 
                                        class="p-2 text-gray-400 hover:text-primary-600 dark:hover:text-primary-400 transition-colors duration-200">
                                    <i class="fas fa-share-alt"></i>
                                </button>
                            </div>
                        </div>
                    </article>
                {% endfor %}
            </div>
            
            <!-- Pagination -->
            {% if is_paginated %}
                <div class="mt-16 flex justify-center" data-aos="fade-up">
                    <nav class="flex items-center space-x-2 rtl:space-x-reverse">
                        {% if page_obj.has_previous %}
                            <a href="?page=1{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" 
                               class="pagination-btn px-3 py-2 text-gray-500 hover:text-primary-600 dark:text-gray-400 dark:hover:text-primary-400 transition-colors duration-200">
                                <i class="fas fa-angle-double-left"></i>
                            </a>
                            <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" 
                               class="pagination-btn px-3 py-2 text-gray-500 hover:text-primary-600 dark:text-gray-400 dark:hover:text-primary-400 transition-colors duration-200">
                                <i class="fas fa-angle-left"></i>
                            </a>
                        {% endif %}
                        
                        {% for num in page_obj.paginator.page_range %}
                            {% if page_obj.number == num %}
                                <span class="px-4 py-2 bg-primary-600 text-white rounded-lg font-medium">{{ num }}</span>
                            {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                                <a href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" 
                                   class="pagination-btn px-4 py-2 text-gray-500 hover:text-primary-600 dark:text-gray-400 dark:hover:text-primary-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors duration-200">
                                    {{ num }}
                                </a>
                            {% endif %}
                        {% endfor %}
                        
                        {% if page_obj.has_next %}
                            <a href="?page={{ page_obj.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" 
                               class="pagination-btn px-3 py-2 text-gray-500 hover:text-primary-600 dark:text-gray-400 dark:hover:text-primary-400 transition-colors duration-200">
                                <i class="fas fa-angle-right"></i>
                            </a>
                            <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}" 
                               class="pagination-btn px-3 py-2 text-gray-500 hover:text-primary-600 dark:text-gray-400 dark:hover:text-primary-400 transition-colors duration-200">
                                <i class="fas fa-angle-double-right"></i>
                            </a>
                        {% endif %}
                    </nav>
                </div>
            {% endif %}
        {% else %}
            <!-- No Posts Found -->
            <div class="text-center py-16" data-aos="fade-up">
                <div class="mb-8">
                    <i class="fas fa-search text-6xl text-gray-300 dark:text-gray-600"></i>
                </div>
                <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-4">
                    {% if search_query %}
                        {% trans "No results found" %}
                    {% else %}
                        {% trans "No posts found" %}
                    {% endif %}
                </h3>
                <p class="text-gray-600 dark:text-gray-300 mb-8 max-w-md mx-auto">
                    {% if search_query %}
                        {% blocktrans with query=search_query %}Sorry, no articles match your search for "{{ query }}". Try different keywords or browse our categories.{% endblocktrans %}
                    {% else %}
                        {% trans "There are no published posts in this category yet. Check back soon for new content!" %}
                    {% endif %}
                </p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a href="{% url 'blog:post_list' %}" class="btn-primary">
                        <i class="fas fa-arrow-left mr-2 rtl:ml-2 rtl:mr-0"></i>
                        {% trans "View All Posts" %}
                    </a>
                    {% if search_query %}
                        <button onclick="clearSearch()" class="btn-outline">
                            <i class="fas fa-times mr-2 rtl:ml-2 rtl:mr-0"></i>
                            {% trans "Clear Search" %}
                        </button>
                    {% endif %}
                </div>
            </div>
        {% endif %}
    </div>
</section>

<!-- Newsletter Subscription -->
{% if not search_query %}
<section class="py-16 bg-primary-600 dark:bg-primary-700">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-3xl font-bold text-white mb-4" data-aos="fade-up">
            {% trans "Stay Updated" %}
        </h2>
        <p class="text-xl text-primary-100 mb-8" data-aos="fade-up" data-aos-delay="200">
            {% trans "Subscribe to get notified about new articles and updates" %}
        </p>
        <form class="max-w-md mx-auto flex gap-3" data-aos="fade-up" data-aos-delay="400">
            <input type="email" placeholder="{% trans 'Enter your email' %}" 
                   class="flex-1 px-4 py-3 rounded-lg border-0 focus:outline-none focus:ring-2 focus:ring-white/50">
            <button type="submit" class="px-6 py-3 bg-white text-primary-600 font-medium rounded-lg hover:bg-gray-100 transition-colors duration-200">
                {% trans "Subscribe" %}
            </button>
        </form>
    </div>
</section>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Sort functionality
        const sortSelect = document.getElementById('sort-select');
        if (sortSelect) {
            sortSelect.addEventListener('change', function() {
                const url = new URL(window.location);
                url.searchParams.set('sort', this.value);
                window.location.href = url.toString();
            });
            
            // Set current sort value
            const currentSort = new URLSearchParams(window.location.search).get('sort');
            if (currentSort) {
                sortSelect.value = currentSort;
            }
        }
        
        // Blog card hover effects
        const blogCards = document.querySelectorAll('.blog-card');
        blogCards.forEach(card => {
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-10px)';
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = 'translateY(0)';
            });
        });
        
        // Smooth scroll for pagination
        document.querySelectorAll('.pagination-btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                // Scroll to top of posts section
                const postsSection = document.querySelector('#posts-grid');
                if (postsSection) {
                    setTimeout(() => {
                        postsSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    }, 100);
                }
            });
        });
    });
    
    // Share post function
    function sharePost(title, url) {
        if (navigator.share) {
            navigator.share({
                title: title,
                url: url
            }).catch(console.error);
        } else {
            // Fallback to copying URL
            navigator.clipboard.writeText(url).then(() => {
                // Show toast notification
                showToast('{% trans "Link copied to clipboard!" %}');
            }).catch(() => {
                // Fallback to opening share dialog
                window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(title)}&url=${encodeURIComponent(url)}`, '_blank');
            });
        }
    }
    
    // Clear search function
    function clearSearch() {
        window.location.href = '{% url "blog:post_list" %}';
    }
    
    // Toast notification function
    function showToast(message) {
        const toast = document.createElement('div');
        toast.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50 transform translate-y-full transition-transform duration-300';
        toast.textContent = message;
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.style.transform = 'translateY(0)';
        }, 100);
        
        setTimeout(() => {
            toast.style.transform = 'translateY(full)';
            setTimeout(() => {
                document.body.removeChild(toast);
            }, 300);
        }, 3000);
    }
</script>

<style>
    .line-clamp-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .line-clamp-3 {
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .btn-primary {
        @apply inline-flex items-center px-6 py-3 border border-transparent text-base font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200;
    }
    
    .btn-outline {
        @apply inline-flex items-center px-6 py-3 border-2 border-gray-300 dark:border-gray-600 text-base font-medium rounded-md text-gray-700 dark:text-gray-300 bg-transparent hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200;
    }
</style>
{% endblock %}